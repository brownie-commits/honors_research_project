TRUE ~ as.numeric(x))
} else {
case_when(
x %in% c(-1, -5, -6, -7, -8, -9, 90, 95) ~ NA_real_,
TRUE ~ as.numeric(x)
)
}
}))
}
anes <- anes_na_clean(anes)
anes <- read_dta("data/Research_DataANES.dta")
anes <- anes %>%
rename(
poltrst = V161215,
strglead = V162263,
pplrule = V162264,
econcond = V161140x,
finsit = V162165,
imharm = V162269,
imecon = V162268,
imempl = V162158,
votechoice = V162034a,
income = V161361x,
race = V161310x,
gender = V161342,
edulevel = V161270
) %>%
select(poltrst, strglead, pplrule, econcond, finsit, imharm, imecon, imempl, votechoice, income, race, gender, edulevel)
anes_na_clean <- function(df) {
df %>%
mutate(across(everything(), ~ {
colname <- cur_column()
x <- haven::zap_labels(.x)
if (colname == "votechoice") {
case_when(
x %in% c(-1, 3, 4, 5, 7, 9, -6, -7, -8, -9) ~ NA_real_,
TRUE ~ as.numeric(x))
} else {
case_when(
x %in% c(-1, -5, -6, -7, -8, -9, 90, 95) ~ NA_real_,
TRUE ~ as.numeric(x)
)
}
}))
}
anes <- anes_na_clean(anes)
anes_reverse_all <- function(df) {
df %>%
mutate(across(everything(), ~ {
colname <- cur_column()
if (colname == "votechoice") {
case_when(
.x == 0 ~ 1,
.x == 2 ~ 1,
TRUE ~ as.numeric(.x)
)
} else if (colname == "race") {
case_when(
.x %in% c(2, 3, 4, 5, 6) ~ 0,
TRUE ~ as.numeric(.x)
)
} else if (colname == "gender") {
case_when(
.x == 2 ~ 0,
TRUE ~ as.numeric(.x)
)
} else if (colname %in% c("poltrst", "strglead", "econcond", "finsit")) {
case_when(
.x == 5 ~ 1,
.x == 2 ~ 4,
.x == 1 ~ 5,
.x == 4 ~ 2,
TRUE ~ as.numeric(.x)
)
}
else {
.x  # untouched
}
}))
}
anes <- anes_reverse_all(anes)
anes <- anes %>%
rename(cgender = gender,
rpoltrst = poltrst,
rstrglead = strglead,
reconcond = econcond,
rfinsit = finsit,
cvotechoice = votechoice,
cgender = gender,
crace = race)
df <- compare_dfs(anes, Research_DataANES)
View(df)
Research_DataANES$poltrst <- ifelse(Research_DataANES$V161215 %in% c(-8, -9), NA, Research_DataANES$V161215)
table(Research_DataANES$pplrule, Research_DataANES$votechoice)
prop.table(table_row, margin = 1) * 100
table(Research_DataANES$poltrst, Research_DataANES$econcond)
View(Research_DataANES)
table(Research_DataANES$rstrglead, Research_DataANES$finsit)
table(Research_DataANES$rstrglead, Research_DataANES$rfinsit)
prop.table(table_row, margin = 1) * 100
na_codes <- list(
votechoice = c(-1, 3, 4, 5, 7, 9, -6, -7, -8, -9),
default = c(-1, -5, -6, -7, -8, -9, 90, 95)
)
reverse_rules <- list(
votechoice = function(x) case_when(x %in% c(0, 2) ~ 1, TRUE ~ x),
race = function(x) case_when(x %in% c(2, 3, 4, 5, 6) ~ 0, TRUE ~ x),
gender = function(x) case_when(x == 2 ~ 0, TRUE ~ x),
poltrst = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x),
strglead = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x),
econcond = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x),
finsit = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x)
)
clean_var <- function(x, colname, na_codes) {
x <- haven::zap_labels(x)
na_vals <- na_codes[[colname]] %||% na_codes$default
case_when(
x %in% na_vals ~ NA_real_,
TRUE ~ as.numeric(x)
)
}
reverse_var <- function(x, colname, reverse_rules) {
rule <- reverse_rules[[colname]]
if (!is.null(rule)) rule(x) else x
}
anes <- anes %>%
mutate(across(everything(), ~ clean_var(.x, cur_column(), na_codes)))
anes <- anes %>%
mutate(across(everything(), ~ reverse_var(.x, cur_column(), reverse_rules)))
rename_map <- c(
"gender" = "cgender",
"poltrst" = "rpoltrst",
"strglead" = "rstrglead",
"econcond" = "reconcond",
"finsit" = "rfinsit",
"votechoice" = "cvotechoice",
"race" = "crace"
)
anes <- anes %>% rename(!!!rename_map)
View(anes)
reverse_rules <- list(
votechoice = function(x) case_when(x == 2 ~ 1, x == 1 ~ 0, TRUE ~ x),
race = function(x) case_when(x %in% c(2, 3, 4, 5, 6) ~ 0, TRUE ~ x),
gender = function(x) case_when(x == 2 ~ 0, TRUE ~ x),
poltrst = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x),
strglead = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x),
econcond = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x),
finsit = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x)
)
clean_var <- function(x, colname, na_codes) {
x <- haven::zap_labels(x)
na_vals <- na_codes[[colname]] %||% na_codes$default
case_when(
x %in% na_vals ~ NA_real_,
TRUE ~ as.numeric(x)
)
}
reverse_var <- function(x, colname, reverse_rules) {
rule <- reverse_rules[[colname]]
if (!is.null(rule)) rule(x) else x
}
anes <- anes %>%
mutate(across(everything(), ~ clean_var(.x, cur_column(), na_codes)))
anes <- anes %>%
mutate(across(everything(), ~ reverse_var(.x, cur_column(), reverse_rules)))
rename_map <- c(
"gender" = "cgender",
"poltrst" = "rpoltrst",
"strglead" = "rstrglead",
"econcond" = "reconcond",
"finsit" = "rfinsit",
"votechoice" = "cvotechoice",
"race" = "crace"
)
anes <- anes %>% rename(!!!rename_map)
anes_all <- read_dta("data/Research_DataANES.dta")
na_codes <- list(
votechoice = c(-1, 3, 4, 5, 7, 9, -6, -7, -8, -9),
default = c(-1, -5, -6, -7, -8, -9, 90, 95)
)
reverse_rules <- list(
votechoice = function(x) case_when(x == 2 ~ 1, x == 1 ~ 0, TRUE ~ x),
race = function(x) case_when(x %in% c(2, 3, 4, 5, 6) ~ 0, TRUE ~ x),
gender = function(x) case_when(x == 2 ~ 0, TRUE ~ x),
poltrst = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x),
strglead = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x),
econcond = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x),
finsit = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x)
)
clean_var <- function(x, colname, na_codes) {
x <- haven::zap_labels(x)
na_vals <- na_codes[[colname]] %||% na_codes$default
case_when(
x %in% na_vals ~ NA_real_,
TRUE ~ as.numeric(x)
)
}
reverse_var <- function(x, colname, reverse_rules) {
rule <- reverse_rules[[colname]]
if (!is.null(rule)) rule(x) else x
}
anes <- read_dta("data/Research_DataANES.dta")
anes <- anes %>%
mutate(across(everything(), ~ clean_var(.x, cur_column(), na_codes)))
anes <- anes %>%
mutate(across(everything(), ~ reverse_var(.x, cur_column(), reverse_rules)))
rename_map <- c(
"gender" = "cgender",
"poltrst" = "rpoltrst",
"strglead" = "rstrglead",
"econcond" = "reconcond",
"finsit" = "rfinsit",
"votechoice" = "cvotechoice",
"race" = "crace"
)
anes <- anes %>% rename(!!!rename_map)
anes <- read_dta("data/Research_DataANES.dta")
anes <- anes %>%
mutate(across(everything(), ~ clean_var(.x, cur_column(), na_codes)))
anes <- anes %>%
mutate(across(everything(), ~ reverse_var(.x, cur_column(), reverse_rules)))
rename_map <- c(
"gender" = "cgender",
"poltrst" = "rpoltrst",
"strglead" = "rstrglead",
"econcond" = "reconcond",
"finsit" = "rfinsit",
"votechoice" = "cvotechoice",
"race" = "crace"
)
anes <- anes %>% rename(!!!rename_map)
anes <- read_dta("data/Research_DataANES.dta")
source("C:/Users/brown/Data-Projects/honors-research-project/data_cleaning_script.R")
source("C:/Users/brown/Data-Projects/honors-research-project/data_cleaning_script.R")
source("C:/Users/brown/Data-Projects/honors-research-project/data_cleaning_script.R")
source("C:/Users/brown/Data-Projects/honors-research-project/data_cleaning_script.R")
View(anes)
source("C:/Users/brown/Data-Projects/honors-research-project/data_cleaning_script.R")
source("C:/Users/brown/Data-Projects/honors-research-project/data_cleaning_script.R")
source("C:/Users/brown/Data-Projects/honors-research-project/data_cleaning_script.R")
View(cleaned_anes)
source("C:/Users/brown/Data-Projects/honors-research-project/data_cleaning_script.R")
df_compare <- compare_dfs(Research_DataANES, cleaned_anes)
View(df_compare)
table(Research_DataANES$poltrst, Research_DataANES$econcond)
prop.table(table_row, margin = 1) * 100
anes %>% map(~ table(.x, useNA = "ifany")) %>% str()
rename_map <- c(
"cgender" = "gender",
"rpoltrst" = "poltrst",
"rstrglead" = "strglead",
"reconcond" = "econcond",
"rfinsit" = "finsit",
"cvotechoice" = "votechoice",
"crace" = "race"
)
na_codes <- list(
votechoice = c(-1, 3, 4, 5, 7, 9, -6, -7, -8, -9),
default = c(-1, -5, -6, -7, -8, -9, 90, 95)
)
reverse_rules <- list(
votechoice = function(x) case_when(x == 2 ~ 1, x == 1 ~ 0, TRUE ~ x),
race = function(x) case_when(x %in% c(2, 3, 4, 5, 6) ~ 0, TRUE ~ x),
gender = function(x) case_when(x == 2 ~ 0, TRUE ~ x),
poltrst = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x),
strglead = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x),
econcond = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x),
finsit = function(x) case_when(x == 5 ~ 1, x == 2 ~ 4, x == 1 ~ 5, x == 4 ~ 2, TRUE ~ x)
)
clean_var <- function(x, colname, na_codes) {
x <- haven::zap_labels(x)
na_vals <- na_codes[[colname]] %||% na_codes$default
case_when(
x %in% na_vals ~ NA_real_,
TRUE ~ as.numeric(x)
)
}
reverse_var <- function(x, colname, reverse_rules) {
rule <- reverse_rules[[colname]]
if (!is.null(rule)) rule(x) else x
}
anes <- read_dta("data/Research_DataANES.dta")
anes <- anes %>%
mutate(across(everything(), ~ clean_var(.x, cur_column(), na_codes)))
anes <- anes %>%
mutate(across(everything(), ~ reverse_var(.x, cur_column(), reverse_rules)))
cleaned_anes <- anes %>% rename(!!!rename_map)
rename_map <- c(
"cgender" = "gender",
"rpoltrst" = "poltrst",
"rstrglead" = "strglead",
"reconcond" = "econcond",
"rfinsit" = "finsit",
"cvotechoice" = "votechoice",
"crace" = "race"
)
cleaned_anes <- anes %>% rename(!!!rename_map)
anes <- read_dta("data/Research_DataANES.dta")
anes <- anes %>%
mutate(across(everything(), ~ clean_var(.x, cur_column(), na_codes)))
anes <- anes %>%
mutate(across(everything(), ~ reverse_var(.x, cur_column(), reverse_rules)))
anes <- read_dta("data/Research_DataANES.dta")
anes <- anes %>%
rename(
poltrst = V161215,
strglead = V162263,
pplrule = V162264,
econcond = V161140x,
finsit = V162165,
imharm = V162269,
imecon = V162268,
imempl = V162158,
votechoice = V162034a,
income = V161361x,
race = V161310x,
gender = V161342,
edulevel = V161270
) %>%
select(poltrst, strglead, pplrule, econcond, finsit, imharm, imecon, imempl,
votechoice, income, race, gender, edulevel)
anes <- anes %>%
mutate(across(everything(), ~ clean_var(.x, cur_column(), na_codes)))
anes <- anes %>%
mutate(across(everything(), ~ reverse_var(.x, cur_column(), reverse_rules)))
cleaned_anes <- anes %>% rename(!!!rename_map)
View(cleaned_anes)
cleaned_anes %>% map(~ table(.x, useNA = "ifany")) %>% str()
ess <- read_dta("data/Research_DataESS_Clean.dta")
table(ess$trstplt)
ess <- ess %>%
mutate(
unemp3m = case_when(
uemp3m == 2 ~ 0,
prtvtbit %in% c(1:8, 10:13) ~ 0,
TRUE ~ unemp3m
),
prtvtbit = case_when(
prtvtbit %in% c(1:8, 10:13) ~ 0,
prtvtbit == 9 ~ 1,
prtvtbit == 14 ~ NA_real_,
TRUE ~ prtvtbit
),
prtvtfnl = case_when(
prtvtfnl %in% c(1:2, 4:11) ~ 0,
prtvtfnl == 3 ~ 1,
prtvtfnl == 16 ~ NA_real_,
TRUE ~ prtvtfnl
),
edlvdit = case_when(
edlvdit == 5555 ~ NA_real_,
TRUE ~ edlvdit
),
edlvenl = case_when(
edlvenl == 5555 ~ NA_real_,
TRUE ~ edlvenl
),
gndr = case_when(
gndr == 2 ~ 0,
TRUE ~ gndr
)
)
View(ess)
ess <- ess %>%
mutate(
uemp3m = case_when(
uemp3m == 2 ~ 0,
prtvtbit %in% c(1:8, 10:13) ~ 0,
TRUE ~ uemp3m
),
prtvtbit = case_when(
prtvtbit %in% c(1:8, 10:13) ~ 0,
prtvtbit == 9 ~ 1,
prtvtbit == 14 ~ NA_real_,
TRUE ~ prtvtbit
),
prtvtfnl = case_when(
prtvtfnl %in% c(1:2, 4:11) ~ 0,
prtvtfnl == 3 ~ 1,
prtvtfnl == 16 ~ NA_real_,
TRUE ~ prtvtfnl
),
edlvdit = case_when(
edlvdit == 5555 ~ NA_real_,
TRUE ~ edlvdit
),
edlvenl = case_when(
edlvenl == 5555 ~ NA_real_,
TRUE ~ edlvenl
),
gndr = case_when(
gndr == 2 ~ 0,
TRUE ~ gndr
)
)
Research_DataESS_Clean$uemp3m[Research_DataESS_Clean$uemp3m == 2] <- 0
Research_DataESS_Clean <- read_dta("data/Research_DataESS_Clean.dta")
Research_DataESS_Clean$uemp3m[Research_DataESS_Clean$uemp3m == 2] <- 0
Research_DataESS_Clean$prtvtbit <- ifelse(Research_DataESS_Clean$prtvtbit %in% c(1, 2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 13), 0,
ifelse(Research_DataESS_Clean$prtvtbit == 9, 1,
ifelse(Research_DataESS_Clean$prtvtbit == 14, NA, Research_DataESS_Clean$prtvtbit)))
Research_DataESS_Clean$prtvtfnl <- ifelse(Research_DataESS_Clean$prtvtfnl %in% c(1, 2, 4, 5, 6, 7, 8, 9, 10, 11), 0,
ifelse(Research_DataESS_Clean$prtvtfnl == 3, 1,
ifelse(Research_DataESS_Clean$prtvtfnl == 16, NA, Research_DataESS_Clean$prtvtfnl)))
Research_DataESS_Clean$edlvdit <- ifelse(Research_DataESS_Clean$edlvdit == 5555, NA, Research_DataESS_Clean$edlvdit)
Research_DataESS_Clean$edlvenl <- ifelse(Research_DataESS_Clean$edlvenl == 5555, NA, Research_DataESS_Clean$edlvenl)
Research_DataESS_Clean$gndr[Research_DataESS_Clean$gndr == 2] <- 0
compare_df <- compare_dfs(Research_DataESS_Clean, ess)
View(compare_df)
View(Research_DataESS_Clean)
ess <- read_dta("data/Research_DataESS_Clean.dta")
ess <- ess %>%
mutate(
uemp3m = case_when(
uemp3m == 2 ~ 0,
TRUE ~ uemp3m
),
prtvtbit = case_when(
prtvtbit %in% c(1:8, 10:13) ~ 0,
prtvtbit == 9 ~ 1,
prtvtbit == 14 ~ NA_real_,
TRUE ~ prtvtbit
),
prtvtfnl = case_when(
prtvtfnl %in% c(1:2, 4:11) ~ 0,
prtvtfnl == 3 ~ 1,
prtvtfnl == 16 ~ NA_real_,
TRUE ~ prtvtfnl
),
edlvdit = case_when(
edlvdit == 5555 ~ NA_real_,
TRUE ~ edlvdit
),
edlvenl = case_when(
edlvenl == 5555 ~ NA_real_,
TRUE ~ edlvenl
),
gndr = case_when(
gndr == 2 ~ 0,
TRUE ~ gndr
)
)
compare_df <- compare_dfs(Research_DataESS_Clean, ess)
ess <- read_dta("data/Research_DataESS_Clean.dta")
code_to_zero <- function(x, codes) case_when(x %in% codes ~ 0, TRUE ~ x)
code_to_one  <- function(x, codes) case_when(x %in% codes ~ 1, TRUE ~ x)
code_to_na   <- function(x, codes) case_when(x %in% codes ~ NA_real_, TRUE ~ x)
ess_test <- ess %>%
mutate(
unemp3m   = code_to_zero(uemp3m, 2) |> code_to_zero(prtvtbit, c(1:8, 10:13)),
prtvtbit  = code_to_zero(prtvtbit, c(1:8, 10:13)) |> code_to_one(9) |> code_to_na(14),
prtvtfnl  = code_to_zero(prtvtfnl, c(1:2, 4:11)) |> code_to_one(3) |> code_to_na(16),
edlvdit   = code_to_na(edlvdit, 5555),
edlvenl   = code_to_na(edlvenl, 5555),
gndr      = code_to_zero(gndr, 2)
)
ess_test <- ess %>%
mutate(
uemp3m   = code_to_zero(uemp3m, 2) |> code_to_zero(prtvtbit, c(1:8, 10:13)),
prtvtbit  = code_to_zero(prtvtbit, c(1:8, 10:13)) |> code_to_one(9) |> code_to_na(14),
prtvtfnl  = code_to_zero(prtvtfnl, c(1:2, 4:11)) |> code_to_one(3) |> code_to_na(16),
edlvdit   = code_to_na(edlvdit, 5555),
edlvenl   = code_to_na(edlvenl, 5555),
gndr      = code_to_zero(gndr, 2)
)
code_to_zero <- function(x, codes) case_when(x %in% codes ~ 0, TRUE ~ x)
code_to_one  <- function(x, codes) case_when(x %in% codes ~ 1, TRUE ~ x)
code_to_na   <- function(x, codes) case_when(x %in% codes ~ NA_real_, TRUE ~ x)
ess_test <- ess %>%
mutate(
uemp3m   = code_to_zero(uemp3m, 2) |> code_to_zero(prtvtbit, c(1:8, 10:13)),
prtvtbit  = code_to_zero(prtvtbit, c(1:8, 10:13)) |> code_to_one(9) |> code_to_na(14),
prtvtfnl  = code_to_zero(prtvtfnl, c(1:2, 4:11)) |> code_to_one(3) |> code_to_na(16),
edlvdit   = code_to_na(edlvdit, 5555),
edlvenl   = code_to_na(edlvenl, 5555),
gndr      = code_to_zero(gndr, 2)
)
ess <- read_dta("data/Research_DataESS_Clean.dta")
ess_test <- ess %>%
mutate(
uemp3m   = code_to_zero(uemp3m, 2) |> code_to_zero(prtvtbit, c(1:8, 10:13)),
prtvtbit  = code_to_zero(prtvtbit, c(1:8, 10:13)) |> code_to_one(9) |> code_to_na(14),
prtvtfnl  = code_to_zero(prtvtfnl, c(1:2, 4:11)) |> code_to_one(3) |> code_to_na(16),
edlvdit   = code_to_na(edlvdit, 5555),
edlvenl   = code_to_na(edlvenl, 5555),
gndr      = code_to_zero(gndr, 2)
)
ess <- read_dta("data/Research_DataESS_Clean.dta")
ess_test <- ess %>%
mutate(
uemp3m   = code_to_zero(uemp3m, 2),
prtvtbit  = code_to_zero(prtvtbit, c(1:8, 10:13)) |> code_to_one(9) |> code_to_na(14),
prtvtfnl  = code_to_zero(prtvtfnl, c(1:2, 4:11)) |> code_to_one(3) |> code_to_na(16),
edlvdit   = code_to_na(edlvdit, 5555),
edlvenl   = code_to_na(edlvenl, 5555),
gndr      = code_to_zero(gndr, 2)
)
compare_df <- compare_dfs(Research_DataESS_Clean, ess_test)
case_when(
x %in% codes ~ 0, TRUE ~ x
)
source("C:/Users/brown/Data-Projects/honors-research-project/code/packages_functions.R")
source("C:/Users/brown/Data-Projects/honors-research-project/code/data_cleaning.R")
source("C:/Users/brown/Data-Projects/honors-research-project/code/packages_functions.R")
source("C:/Users/brown/Data-Projects/honors-research-project/code/data_cleaning.R")
source("C:/Users/brown/Data-Projects/honors-research-project/code/packages_functions.R")
source("C:/Users/brown/Data-Projects/honors-research-project/code/data_cleaning.R")
source("C:/Users/brown/Data-Projects/honors-research-project/code/packages_functions.R")
source("C:/Users/brown/Data-Projects/honors-research-project/code/data_cleaning.R")
View(cleaned_anes)
View(anes)
View(ess)
